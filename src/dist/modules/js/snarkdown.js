const TAGS={"":["<em>","</em>"],_:["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function outdent(a){return a.replace(RegExp("^"+(a.match(/^(\t| )+/)||"")[0],"gm"),"")}function encodeAttr(a){return(a+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}export default function p(e,v){var h,n,i,g,k,m,o;let t=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:\!\[([^\]]*?)\]\(([^\)]+?)\))|(\[)|(\](?:\(([^\)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(\-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,3})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)|((?:(?:^|\n+)(?:\|.*))+)/gm,d=[],f="",r=v||{},q=0,b,j,a,l,c;function s(a){var b=TAGS[a.replace(/\*/g,"_")[1]||""],c=d[d.length-1]==a;return b?b[1]?(d[c?"pop":"push"](a),b[c|0]):b[0]:a}function u(){let a="";while(d.length)a+=s(d[d.length-1]);return a}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,(c,a,b)=>(r[a.toLowerCase()]=b,"")).replace(/^\n+|\n+$/g,"");a=t.exec(e);){if(j=e.substring(q,a.index),q=t.lastIndex,b=a[0],j.match(/[^\\](\\\\)*\\$/));else if(a[3]||a[4])b='<pre class="code '+(a[4]?"poetry":a[2].toLowerCase())+'">'+outdent(encodeAttr(a[3]||a[4]).replace(/^\n+|\n+$/g,""))+"</pre>";else if(a[6])c=a[6],c.match(/\./)&&(a[5]=a[5].replace(/^\d+/gm,"")),l=p(outdent(a[5].replace(/^\s*[>*+.-]/gm,""))),c===">"?c="blockquote":(c=c.match(/\./)?"ol":"ul",l=l.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),b="<"+c+">"+l+"</"+c+">";else if(a[8])b=`<img src="${encodeAttr(a[8])}" alt="${encodeAttr(a[7])}">`;else if(a[10])f=f.replace("<a>",`<a href="${encodeAttr(a[11]||r[j.toLowerCase()])}">`),b=u()+"</a>";else if(a[9])b="<a>";else if(a[12]||a[14])c="h"+(a[14]?a[14].length:a[13][0]==="="?1:2),b="<"+c+">"+p(a[12]||a[15],r)+"</"+c+">";else if(a[16])b="<code>"+encodeAttr(a[16])+"</code>";else if(a[17]||a[1])b=s(a[17]||"--");else if(a[18]){for(h=a[18].split("\n"),n=h.length,i="",g="td>";n--;){if(h[n].match(/^\|\s+---+.*$/)){g="th>";continue}for(k=h[n].split(/\|\s*/),m=k.length,o="";m--;)o=(k[m]?`<${g+p(k[m])}</${g}`:"")+o;i=`<tr>${o}</tr>`+i,g="td>"}b=`<table>${i}</table>`}f+=j,f+=b}return(f+e.substring(q)+u()).trim()}