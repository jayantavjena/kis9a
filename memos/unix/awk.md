ユーザ毎の CPU 使用率を見る
$ ps aux | awk '{ if(NR>1){p[$1] += $3; n[$1]++ }}END{for(i in p) print p[i], n[i], i}'

# 文字数カウント(wc -c)

$ awk '{n+=length($0)} END{print n}' filename

# 単語数カウント(wc -w)

$ awk '{n+=NF} END{print n}' filename

# 行数カウント(wc -l)

$ awk 'END{print NR}' filename

指定行から指定行まで表示
$ awk 'NR==10,NR==20'

# 奇数行

$ awk 'NR%2' filename

# 偶数行

$ awk 'NR%2==0' filename

```
 FS        入力フィールドセパレータ(空白とタブ)
 CNVFMT        数値を文字列に変換するフォーマット
 OFMT          数字の出力フォーマット(%.6g)
 OFS           出力フィールドセパレータ（空白）
 ORS           出力レコードセパレータ（\n）
 RS        入力レコードセパレータ（\n）
 SUBSEP        配列添字セパレータ(\034)
 ARGC          コマンド行の引数の数+1
 ARGV          コマンド行の引数の配列
 ENVIRON["..."] 環境変数の値
 FILENAME       入力ファイル名
 FNR           入力ファイルの通算レコード
 NF        入力レコードのフィールド数
 NR        入力レコード総数
 RLENGTH       matchで適合した文字列の長さ
 RSTART        matchで適合した文字列の開始位置


printf("%d\n",x)               #整数として出力
printf("%5d\n",x)              #5桁で右詰の整数として出力
printf("%e\n",x)               #浮動小数点数(eの後の数字は10の累乗を表す)
printf("%7.2f\n",x)            #浮動小数点数、7桁で小数第2位まで
printf("%6.2f\n",x)            #浮動小数点数、6桁で小数第2位まで
printf("%5.2f\n",x)            #浮動小数点数、5桁で小数第2位まで
printf("%4.2f\n",x)            #浮動小数点数、4桁で小数第2位まで
printf("%o\n",x)               #8進数として出力
printf("%x\n",x)               #16進数として出力
printf("%c\n",x)               #文字コードして対応するアルファベットを出力
printf("%s\n",x)               #そのまま文字列として出力
printf("%10s\n",x)             #右詰で10桁のスペースに出力
printf("%-10s\n",x)            #左詰で10桁のスペースに出力
printf("%.3s\n",x)             #左詰で3文字のみ出力
printf("%10.3s\n",x)           #右詰で10桁のスペースに3文字を出力
printf("%-10.3s\n",x)          #左詰で10桁のスペースに3文字を出力

#ワンライナーで使う場合は以下のように置き換えればOK
echo 12345 | awk '{ printf("%-10.3s\n",$0) }'
```

[awk コマンド（テキストの加工やパターン処理をする） : JP1/Advanced Shell](http://itdoc.hitachi.co.jp/manuals/3021/3021313320/JPAS0315.HTM)

| 制御文                            | 構文                                                                                     | 内容                                                                                                                                           |
| --------------------------------- | ---------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| if 文                             | if (条件式) 処理 [else 処理]                                                             | 条件分岐します。                                                                                                                               |
| if (変数 in 配列) 処理[else 処理] | 変数に指定した添え字の配列要素が配列に存在するかどうかを判定します。                     |
| while 文                          | while (条件式) 処理                                                                      | 条件が成立している間，繰り返します。                                                                                                           |
| for 文                            | for (初期化式; 継続条件式; 再初期化式) 処理                                              | 繰り返し実行します。                                                                                                                           |
| for (変数 in 配列) 処理           | 各配列要素の添え字の値を順次取り出しながら処理します。添え字の値の取り出しは順不同です。 |
| do 文                             | do 処理 while (継続条件式)                                                               | 後判定によって条件が成立している間，繰り返します。                                                                                             |
| break 文                          | break                                                                                    | 繰り返し処理を抜けます。                                                                                                                       |
| continue 文                       | continue                                                                                 | 繰り返し処理を中断して，繰り返し処理の先頭に戻ります。                                                                                         |
| next 文                           | next                                                                                     | 処理中の入力レコードに対して，この制御文以降の処理を停止し，次の入力レコードの処理を開始します。                                               |
| nextfile 文                       | nextfile                                                                                 | 処理中の入力ファイルに対して，この制御文以降の処理を停止し，次の入力ファイルの処理を開始します。                                               |
| return 文                         | return [expr]                                                                            | ユーザー定義関数を終了します。式 expr で指定した値を呼び出し元に返します。式 expr を指定しない場合は，0 がユーザー定義関数の戻り値となります。 |
| delete 文                         | delete 配列                                                                              | 配列を削除します。                                                                                                                             |
| delete 配列[要素]                 | 配列の要素を削除します。                                                                 |
| exit 文                           | exit [expr]                                                                              | 処理中のスクリプトの実行を停止します。                                                                                                         |

| 関数名        | 内容                                                                                                                                |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| atan2(y,x)    | y/x の逆正接を返します。単位はラジアンです。引数が不足している場合は 1 を返し，警告メッセージを出力します。                         |
| cos(x)        | x の余弦を返します。単位はラジアンです。                                                                                            |
| exp(x)        | x の指数関数を返します。結果がオーバーフローまたはアンダーフローする場合は 1 を返し，警告メッセージを出力します。                   |
| int(x)        | x の小数点以下を切り捨てて整数を返します。                                                                                          |
| log(x)        | x の自然対数を返します。x が 0 または負の場合は 1 を返し，警告メッセージを出力します。                                              |
| rand()        | 乱数 n を返します（0≦n ＜ 1 の範囲）。srand 関数でシード値を設定しない場合は，コマンドを実行するたびに同じ値を返します。            |
| sin(x)        | x の正弦を返します。単位はラジアンです。                                                                                            |
| sqrt(x)       | x の平方根を返します。x が負の場合は 1 を返し，警告メッセージを出力します。                                                         |
| srand([expr]) | 式 expr を rand 関数用のシード値を設定して，設定したシード値を返します。expr を省略した場合は，時刻を基にしたシード値を設定します。 |

| 関数名                    | 内容                                                                                                                                                                                                                                                                                                  |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| gsub(r, t[, s])           | 文字列 s 中のすべての正規表現 r を t に置き換えます。s を省略した場合，$0（レコード全体が格納されているフィールド変数）を置き換え対象とします。t に&を指定した場合は，&が一致した文字列に置き換えられます。返り値として置き換えた回数を返します。                                                     |
| index(s,t)                | 文字列 s 中の文字列 t の位置を返します。文字列 t がなかった場合は 0 を返します。                                                                                                                                                                                                                      |
| length[([s])]             | 文字列 s の文字数を返します。s を指定しなかった場合は，$0（レコード全体が格納されているフィールド変数）の文字数を返します。                                                                                                                                                                           |
| match(s, r)               | 文字列 s 中の正規表現 r が現れる位置を返します。正規表現 r がなかった場合には 0 を返します。また，RSTART 組み込み変数には正規表現 r に一致した文字列の位置が設定されます。不一致時は 0 になります。RLENGTH 組み込み変数には正規表現 r に一致した文字列の長さが設定されます。不一致時は-1 になります。 |
| sprintf(書式, 式[, ... ]) | 書式に従って，式を整形した結果の文字列を返します。書式については出力書式の説明を参照してください。                                                                                                                                                                                                    |
| split(s, array[, fs])     | 文字列 s をフィールドセパレータ fs によってフィールド分割し，配列 array に格納します。戻り値として配列の要素数を返します。分割した各フィールドの値は，配列 array に，array[1]，array[2]，…，array[戻り値]の順に格納されます。                                                                         |

フィールドセパレータ fs の指定を省略した場合は，フィールドセパレータとして組み込み変数 FS の値が使用されます。

フィールドセパレータ fs には文字列および正規表現を指定できます。また，フィールドセパレータ fs に文字指定なしを示す「""」を指定した場合は，1 文字ずつ分割されます。 |
| sub(r, t[, s]) | 文字列 s 中に最初にあった正規表現 r を t に置き換えます。s を省略した場合，$0（レコード全体が格納されているフィールド変数）を置き換え対象とします。t に&を指定した場合は，&が一致した文字列に置き換えられます。返り値として正規表現 r があった場合は 1 を返します。正規表現 r がなかった場合は 0 を返します。 |
| substr(s, m[, n]) | 文字列 s の m 番目の文字から最大 n 文字の部分文字列を返します。n を省略した場合は，m 番目以降のすべての文字列を返します。 |
| tolower(str) | 文字列 str 中のすべての英大文字を英小文字に変換した文字列を返します。 |
| toupper(str) | 文字列 str 中のすべての英小文字を英大文字に変換した文字列を返します。 |

| 関数名       | 内容                                                                                                                                                       |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| compl(x)     | 整数 x の 1 の補数を返します。                                                                                                                             |
| and(x, y)    | 整数 x と整数 y のビットごとの論理積を返します。                                                                                                           |
| or(x, y)     | 整数 x と整数 y のビットごとの論理和を返します。                                                                                                           |
| xor(x, y)    | 整数 x と整数 y のビットごとの排他的論理和を返します。                                                                                                     |
| lshift(x, n) | 整数 x をビット数 n 分，左にシフトした値を返します。ビットのシフトは算術シフトで行われるため，符号部分もシフト対象となります。                             |
| rshift(x, n) | 整数 x をビット数 n 分，右にシフトした値を返します。ビットのシフトは算術シフトで行われるため，符号部分は右にシフトした時に補てんする符号として扱われます。 |

| 関数名             | 内容                                                                               |
| ------------------ | ---------------------------------------------------------------------------------- |
| system(コマンド名) | コマンド名に指定したプログラムを実行し，実行したプログラムのステータスを返します。 |

コマンド名は，実行するプログラムの名称とその引数の値を"（ダブルクォーテーション）で囲んで，コマンドライン形式で記述します。コマンド名の代わりにコマンド名を代入した変数の名称も指定できます。

UNIX の場合，実行したプログラムのステータスは，プログラムが返す終了コードの下位 8 ビットの値となります。 |

| 変数名    | 内容                                                           |
| --------- | -------------------------------------------------------------- |
| $0        | 入力ファイルから現在読み込んでいるレコードの内容を設定します。 |
| $1,$2,... | 現在読み込んでいるレコードの内容を順に設定します。             |

組み込み変数 FS の値によって分割された各フィールド値が，レコードの最初のフィールドに$1 変数，2 番目のフィールドに$2 変数というように設定されます。 |
| $変数名 | 変数にフィールド番号を設定することで，$0 や$1 など直接フィールド番号を記述した場合と同じようにフィールドを参照できます。

※

関数や制御文で使用する場合，使用する前に変数にフィールド番号を設定する必要があります。 |
| $(式) | フィールド番号を求める式（変数名+1 など）を式に指定することで，$0 や$1 など直接フィールド番号を記述した場合と同じようにフィールドを参照できます。 |

| 変数名 | 内容                                                                                                                                                                                                                    |
| ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ARGC   | コマンドライン引数の個数です。オプション値およびスクリプト指定値は含みません。スクリプトおよび-v オプションで変更できます。-v オプションで ARGC に 0 を設定した場合，引数に対象パス名が指定されていない状態になります。 |
| ARGV   | コマンドライン引数の配列です。スクリプトで変更できます。引数に指定した対象パス名が格納されている要素に NULL を設定すると，入力ファイルからレコードの入力が行われません。-v オプションで指定した値は上書きされます。     |

| CONVFMT

※ | 数値を変換するときに使用する変換書式です。デフォルトは%.6g です。数値に小数部分がある場合に有効となります。 |
| ENVIRON | 実行時の環境変数の配列です。添字は環境変数名です。環境変数名は"（ダブルクォーテーション）で囲んで指定します。環境変数名の代わりに環境変数名を代入した変数の名称も指定できます。 |
| FILENAME | 現在の入力ファイル名です。標準入力からの入力の場合はファイル名に「-」が設定されます。 |
| FNR | 現在の入力ファイルの入力レコード数です。対象パス名で指定したファイルから 1 レコードを入力するたびに更新されます。また，「getline [変数名]」でレコードを入力するときにも更新されます。

複数の対象パス名を指定した場合，次の入力ファイルから入力を開始するときに 0 で初期化されます。 |
| FS | フィールドセパレータです。デフォルトは 1 バイトのスペースです。正規表現を使用できます。フィールドセパレータを変更する場合，指定する文字列の長さは 99 バイト以下にしてください。また，フィールドセパレータ値が 1 バイトのスペースの場合は，1 バイトのスペースとタブ(

\

t)によってフィールド分割されます。フィールドセパレータに値を設定しない場合は，1 文字ずつフィールド分割されます。

複数の文字を指定する場合は，正規表現となるため，

\

はエスケープ文字として扱われます。-F オプションと同時に使用した場合は，この変数の値が優先されます。 |
| NF | 現在の入力レコードのフィールド数です。対象パス名で指定したファイルからレコードを入力すると格納されます。また，getline 関数でフィールド変数$0 にレコードを入力したときにも格納されます。

$NF と記述すると，現在の入力レコードの最終フィールドの値を参照できます。 |
| NR | 現在までに読み込んだ入力レコード数です。対象パス名で指定したファイルから 1 レコードを入力するたびに更新されます。また，「getline [変数名]」で次のレコードを入力するときにも更新されます。

複数の対象パス名を指定した場合は，レコードの入力が終了したファイルのレコード数も含まれます。 |
| OFMT

※ | 数値の出力書式です。デフォルトは%.6g です。数値に小数部分がある場合に有効となります。 |
| OFS | 出力フィールドセパレータです。デフォルトは 1 バイトのスペースです。 |
| ORS | 出力レコードセパレータです。デフォルトは改行文字（

\

n）です。Windows の場合，改行文字（

\

n）は［CR］+［LF］で出力されます。 |
| RLENGTH | match 関数で一致した文字列の長さです。一致しなかった場合は-1 が設定されます。 |
| RS | 入力レコードセパレータです。デフォルトは改行文字です。値を変更する場合，1 バイトの文字だけ設定できます。文字列やマルチバイト文字を指定した場合は，先頭 1 バイトを使用します。改行文字（

\

n）を設定した場合，Windows は，入力ファイル中の［CR］+［LF］または［LF］が対象となります。UNIX は，入力ファイル中の［LF］が対象となります。改行文字以外の値を設定した場合，Windows は，入力レコードに含まれる改行文字は［LF］です。UNIX は，入力ファイル中の改行文字が［CR］+［LF］の場合は［CR］も含まれます。 |
| RSTART | match 関数で一致した文字列の開始位置です。一致しなかった場合は 0 が設定されます。 |
| SUBSEP | 多次元配列のセパレータです。デフォルトは 0x1C です。 |

| 演算子 | 説明 |
| ------ | ---- |

| =，+=，-=，

\*

=，/=，%=，^=，

\*\*

= | 代入演算子です。 |
| ?: | 三項演算子です。 |
| \|\| | 論理 OR です。 |
| && | 論理 AND です。 |
| ~，!~ | 正規表現の一致(~)と不一致(!~)です。 |
| <，<=，>，>=，!=，== | 関係演算子です。 |
| スペース | 文字列連結です。 |
| +，- | 加算および減算です。 |
| \*

，/，% | 乗算，除算および剰余です。 |
| +，-，! | 単項および論理否定です。 |
| ^，

\*\* | 累乗です。 |
| ++，-- | インクリメントおよびデクリメントです。 |

| 文字 | 説明                                                                                                                                  |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------- |
| c    | 1 バイト文字です。                                                                                                                    |
| s    | 文字列です。                                                                                                                          |
| d    | 符号付き 10 進整数です。                                                                                                              |
| i    |
| o    | 符号なし 8 進整数です。                                                                                                               |
| x    | 符号なし 16 進整数です。10〜15 の値には「abcdef」を使用します。                                                                       |
| X    | 符号なし 16 進整数です。10〜15 の値には「ABCDEF」を使用します。                                                                       |
| u    | 符号なし 10 進整数です。                                                                                                              |
| f    | 浮動小数点数です。[-]dddd.dddd 形式に変換します。                                                                                     |
| e    | 浮動小数点数です。[-]d.dddde[+-]dd[d]形式に変換します。                                                                               |
| g    | 変換指定子 e または f で出力される符号付きの値のうち，指定された値および精度を表現できる短い方の書式です。末尾の 0 は出力されません。 |
| E    | 浮動小数点数です。[-]d.ddddE[+-]dd[d]形式に変換します。                                                                               |
| G    | 変換指定子 E または f で出力される符号付きの値のうち，指定された値および精度を表現できる短い方の書式です。末尾の 0 は出力されません。 |
| %    | %の文字です。                                                                                                                         |

| 文字コード種別 | 指定できる値（16 進数値）       |
| -------------- | ------------------------------- |
| シフト JIS     | 0x01-0x80，0xA0-0xDF，0xFD-0xFF |
| UTF-8          | 0x01-0xBF，0xFE-0xFF            |
| EUC            | 0x01-0x8D，0x90-0xA0，0xFF      |
| C              | 0x01-0xFF                       |

| 特殊ファイル名 | 意味           |
| -------------- | -------------- |
| /dev/stdin     | 標準入力       |
| /dev/stdout    | 標準出力       |
| /dev/stderr    | 標準エラー出力 |

| 終了コード          | 意味                                           |
| ------------------- | ---------------------------------------------- |
| 0                   | 正常終了                                       |
| 1 以上              | エラー終了                                     |
| exit 文で指定した値 | 制御文の exit 文で指定したコマンドの終了コード |
